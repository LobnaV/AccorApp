<div class="container login my-4">
  <div class="row">
    <div class="col-md-10 col-sm-12 offset-md-1 offset-sm-0">
      <div class="card" *ngIf="!success && !keyMissing">
        <div class="d-flex justify-content-center">
          <h1 class="text-center">{{"layouts.reset-finish.title" | translate}}</h1>
          <div class="align-self-center m-2">
            <select #selLang (change)="translateLanguageTo(selLang.value)">
              <option *ngFor="let language of translate.getLangs()" [value]="language">{{ language }}</option>
            </select>
          </div>
        </div>
        <div class="card-body">
          <form (ngSubmit)="finishReset()" [formGroup]="passwordForm!">

            <div class="inputs">
              <div class="form-group col-md-8">
                <div class="form-outline">
                  <label class="form-label" for="password">{{"layouts.reset-finish.password" | translate}}</label>
                  <input type="password" class="form-control" id="password" name="password"
                         [ngClass]="{'is-invalid': passwordForm?.get('newPassword')?.invalid && (passwordForm?.get('newPassword')?.dirty || passwordForm?.get('newPassword')?.touched) }"
                         formControlName="newPassword">
                  <div *ngIf="passwordForm?.get('newPassword')?.invalid && (passwordForm?.get('newPassword')?.dirty || passwordForm?.get('newPassword')?.touched)">
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('newPassword')?.errors!['required']">
                      {{"exception.validations.required" | translate}}
                    </p>
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('newPassword')?.errors!['minlength']">
                      {{"exception.validations.minPassword" | translate}}
                    </p>
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('newPassword')?.errors!['maxlength']">
                      {{"exception.validations.maxPassword" | translate}}
                    </p>
                  </div>
                </div>
              </div>
              <div class="form-group col-md-8">
                <div class="form-outline">
                  <label class="form-label" for="confirmPassword">{{"layouts.reset-finish.pwdConfirmation" | translate}}</label>
                  <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                         [ngClass]="{'is-invalid': passwordForm?.get('confirmPassword')?.invalid && (passwordForm?.get('confirmPassword')?.dirty || passwordForm?.get('confirmPassword')?.touched) }"
                         formControlName="confirmPassword">
                  <div *ngIf="passwordForm?.get('confirmPassword')?.invalid && (passwordForm?.get('confirmPassword')?.dirty || passwordForm?.get('confirmPassword')?.touched)">
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('confirmPassword')?.errors!['required']">
                      {{"exception.validations.required" | translate}}
                    </p>
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('confirmPassword')?.errors!['minlength']">
                      {{"exception.validations.minPassword" | translate}}
                    </p>
                    <p class="validation-error"
                       *ngIf="passwordForm?.get('confirmPassword')?.errors!['maxlength']">
                      {{"exception.validations.maxPassword" | translate}}
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex justify-content-around">
              <button type="button" class="btn btn-secondary" (click)="login()">{{"layouts.reset-finish.connexion" | translate}}</button>
              <button [disabled]="passwordForm?.invalid || loading  " class="btn btn-primary" type="submit">{{"layouts.reset-finish.reset" | translate}}</button>
            </div>
          </form>
        </div>
      </div>

      <div class="alert alert-danger" *ngIf="keyMissing">
        <strong>{{"layouts.reset-finish.error.error1" | translate}}</strong>
      </div>

      <div class="alert alert-info" *ngIf="!success && !keyMissing && !error">
        <p>{{"layouts.reset-finish.error.error2" | translate}}</p>
      </div>

      <div class="alert alert-danger" *ngIf="error">
        <p>{{"layouts.reset-finish.error.error3" | translate}}</p>
      </div>

      <p class="alert alert-success" *ngIf="success">
        <span>{{"layouts.reset-finish.error.error4" | translate}}</span>
        <a class="alert-link" (click)="login()">{{"layouts.reset-finish.connexion" | translate}}</a>.
      </p>

      <div class="alert alert-danger" *ngIf="doNotMatch">
        {{"layouts.reset-finish.error.error5" | translate}}
      </div>

      <div class="alert alert-danger" *ngIf="error">
        {{"exception.error." + error | translate}}
      </div>
    </div>
  </div>
</div>
